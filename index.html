<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard RRHH - B√∫squeda Documental</title>
    <style>
        /* --- ESTILOS CSS (Dise√±o Centrado y Simple) --- */
        :root {
            --primary: #007bff;
            --bg: #f4f6f9;
            --card-bg: #ffffff;
            --border: #dee2e6;
            --text-main: #343a40;
            /* Nuevos colores condicionales */
            --color-celeste: #29b6f6; /* Celeste/Sky Blue para Conformidad OK */
            --color-verde: #28a745; /* Verde para Firmado SI */
            --color-rojo: #dc3545; /* Rojo para No Conforme / Firmado NO */
            --color-amarillo: #ffc107; /* Amarillo para Pendiente */
            --color-gris: #6c757d; /* Gris para Neutro */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
        }

        .contenedor-principal {
            width: 100%;
            max-width: 1000px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--card-bg);
        }

        .panel-contenido {
            padding: 30px;
            border-bottom: 1px solid var(--border);
        }
        
        /* Estilo para el t√≠tulo */
        h2 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }

        /* Estilo para los grupos de input/select */
        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-main);
            font-size: 0.9em;
        }

        .input-group input[type="text"],
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input[type="text"]:focus,
        .input-group select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        /* Botones generales */
        button {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(1px);
        }

        /* TABLA DE RESULTADOS */
        #tablaResultados {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9em;
        }

        #tablaResultados th,
        #tablaResultados td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        #tablaResultados th {
            background-color: #e9ecef;
            color: var(--text-main);
            font-weight: 700;
            position: sticky; /* Fija los encabezados al hacer scroll */
            top: 0;
            z-index: 10;
        }

        #tablaResultados tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* Panel de estado y mensaje de error */
        #panelEstado {
            padding: 20px;
            text-align: center;
            color: var(--text-main);
            font-size: 1.1em;
        }

        /* Utilidad para ocultar elementos */
        .hidden {
            display: none !important;
        }

        /* Estilos para etiquetas condicionales */
        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8em;
            color: white;
            text-shadow: 0 0 1px rgba(0, 0, 0, 0.2);
        }
        .tag-verde { background-color: var(--color-verde); }
        .tag-celeste { background-color: var(--color-celeste); }
        .tag-rojo { background-color: var(--color-rojo); }
        .tag-amarillo { background-color: var(--color-amarillo); }
        .tag-gris { background-color: var(--color-gris); }

        /* Estilos de responsividad para filtros */
        .grid-2-cols {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Dos columnas iguales */
            gap: 20px; /* Espacio entre los elementos */
            margin-bottom: 20px;
        }
        
        /* ESTILO NUEVO: Para agrupar los botones de Buscar y Limpiar a la izquierda */
        .button-group-left {
            display: flex;
            gap: 10px; /* Espacio entre los botones */
            justify-content: flex-start; /* Alineaci√≥n a la izquierda */
            padding-top: 10px;
        }

        /* Media Queries para responsividad */
        @media (max-width: 768px) {
            body {
                padding: 20px;
            }
            .grid-2-cols {
                grid-template-columns: 1fr; /* Una columna en m√≥viles */
            }
            #tablaResultados {
                display: block;
                overflow-x: auto; /* Permite scroll horizontal en tablas grandes */
                white-space: nowrap;
            }
            .panel-contenido {
                padding: 20px;
            }
        }
    </style>
</head>
<body>

<div class="contenedor-principal">
    
    <!-- 1. PANEL PRINCIPAL Y B√öSQUEDA R√ÅPIDA -->
    <div class="panel-contenido">
        <h2>üîé B√∫squeda Documental</h2>

        <!-- Input Principal -->
        <div class="input-group">
            <label for="txtRUC">Ingrese RUC a buscar:</label>
            <!-- Usaremos un 'form' simple para capturar el Enter -->
            <form id="formBusquedaPrincipal" onsubmit="buscarDatos(event); return false;">
                <input type="text" id="txtRUC" placeholder="Escriba RUC o DNI (ej: 20500000001)" required>
                <!-- El bot√≥n Buscar se ha movido al panel de filtros -->
            </form>
        </div>

        <!-- Bot√≥n para Mostrar/Ocultar Filtros -->
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="toggleFiltros()">
                <span id="textoBotonFiltros">‚ûï Mostrar Filtros Avanzados</span>
            </button>
        </div>
    </div>

    <!-- 2. PANEL DE FILTROS AVANZADOS (Ahora incluye los botones de acci√≥n) -->
    <div id="filtrosAvanzados" class="panel-contenido" style="margin-top: 20px; display: none;">
        <h3>Filtros Adicionales</h3>
        <form id="formFiltros">
            <div class="grid-2-cols">
                <!-- 2.1. Periodo -->
                <div class="input-group">
                    <label for="slcPeriodo">Per√≠odo Fiscal:</label>
                    <select id="slcPeriodo">
                        <option value="">(Todos)</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                    </select>
                </div>
                <!-- 2.2. Tipo Documento -->
                <div class="input-group">
                    <label for="slcTipoDoc">Tipo de Documento:</label>
                    <select id="slcTipoDoc">
                        <option value="">(Todos)</option>
                        <option value="NOMINA">N√≥mina</option>
                        <option value="CONTRATO">Contrato</option>
                        <option value="ANEXO">Anexo</option>
                    </select>
                </div>
                <!-- 2.3. Estado Firmado -->
                <div class="input-group">
                    <label for="slcFirmado">Estado Firmado:</label>
                    <select id="slcFirmado">
                        <option value="">(Todos)</option>
                        <option value="Si">Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <!-- 2.4. Conformidad -->
                <div class="input-group">
                    <label for="slcConformidad">Estado Conformidad:</label>
                    <select id="slcConformidad">
                        <option value="">(Todos)</option>
                        <option value="Conforme">Conforme</option>
                        <option value="Pendiente">Pendiente</option>
                        <option value="No Conforme">No Conforme</option>
                    </select>
                </div>
            </div>

            <!-- 2.5. BOTONES DE ACCI√ìN (BUSCAR y LIMPIAR) - Implementaci√≥n de la solicitud -->
            <div class="button-group-left">
                <!-- Bot√≥n BUSCAR (texto 'Buscar' solicitado) -->
                <button id="btnBuscar" type="button" onclick="buscarDatos(event)">
                    <span style="font-size: 1.2em;">üîç Buscar</span>
                </button>
                <!-- Nuevo Bot√≥n LIMPIAR (mismo estilo de fondo) -->
                <button id="btnLimpiar" type="button" onclick="limpiarCampos()">
                    <span style="font-size: 1.2em;">üßπ Limpiar</span>
                </button>
            </div>
        </form>
    </div>

    <!-- 3. PANEL DE ESTADO Y RESULTADOS -->
    <div class="panel-contenido">
        <div id="panelEstado">
            <p style="color: var(--primary);">Ingrese un RUC y use el bot√≥n 'Buscar'.</p>
        </div>

        <table id="tablaResultados" class="hidden">
            <thead>
                <tr>
                    <th>RUC</th>
                    <th>Raz√≥n Social</th>
                    <th>Doc. ID</th>
                    <th>Tipo Doc.</th>
                    <th>Emisi√≥n</th>
                    <th>Vence</th>
                    <th>Monto</th>
                    <th>Periodo</th>
                    <th>Firmado</th>
                    <th>Conformidad</th>
                    <th>Observaciones</th>
                </tr>
            </thead>
            <tbody id="cuerpoTabla">
                <!-- Los resultados de la b√∫squeda se insertar√°n aqu√≠ -->
            </tbody>
        </table>
    </div>

</div>

<script>
    // URL de la API (simulada)
    // NOTA: Esta URL debe ser reemplazada por su endpoint real en un entorno de producci√≥n.
    const API_URL_BASE = 'https://jsonplaceholder.typicode.com/todos';

    // --- FUNCIONES DE UTILIDAD ---

    /**
     * Funci√≥n para obtener el valor a mostrar. Si es nulo o vac√≠o, muestra un valor por defecto.
     * @param {string} valor - El valor original.
     * @param {string} defaultValue - El valor por defecto a mostrar.
     * @returns {string} El valor procesado.
     */
    function getDisplayValue(valor, defaultValue) {
        return (valor === null || valor === undefined || valor.trim() === '') ? defaultValue : valor;
    }

    /**
     * Funci√≥n que genera la etiqueta HTML con el estilo condicional (tag).
     * @param {string} valor - El valor del estado ('Si', 'No', 'Conforme', etc.).
     * @returns {string} La etiqueta HTML con el color y el texto.
     */
    function generarEtiqueta(valor) {
        let clase = 'tag-gris';
        let texto = valor;
        let icono = '';

        if (valor === 'Si') {
            clase = 'tag-verde';
            icono = '‚úÖ';
        } else if (valor === 'No') {
            clase = 'tag-rojo';
            icono = '‚ùå';
        } else if (valor === 'Conforme') {
            clase = 'tag-celeste';
            icono = 'üëç';
        } else if (valor === 'No Conforme') {
            clase = 'tag-rojo';
            icono = 'üëé';
        } else if (valor === 'Pendiente') {
            clase = 'tag-amarillo';
            icono = '‚è≥';
        }

        return `<span class="tag ${clase}">${icono} ${texto}</span>`;
    }

    // --- FUNCI√ìN DE CONTROL DE FILTROS ---

    /**
     * Muestra u oculta el panel de filtros avanzados.
     */
    function toggleFiltros() {
        const filtrosDiv = document.getElementById('filtrosAvanzados');
        const botonTexto = document.getElementById('textoBotonFiltros');

        if (filtrosDiv.style.display === 'none') {
            filtrosDiv.style.display = 'block';
            botonTexto.innerHTML = '‚ûñ Ocultar Filtros Avanzados';
        } else {
            filtrosDiv.style.display = 'none';
            botonTexto.innerHTML = '‚ûï Mostrar Filtros Avanzados';
        }
    }

    // --- FUNCI√ìN NUEVA: LIMPIAR CAMPOS ---

    /**
     * Limpia el campo RUC y restablece todos los filtros avanzados.
     */
    function limpiarCampos() {
        // 1. Limpiar el RUC principal
        document.getElementById('txtRUC').value = '';

        // 2. Obtener el formulario de filtros avanzados
        const formFiltros = document.getElementById('formFiltros');
        if (formFiltros) {
            // Itera sobre todos los elementos dentro del formulario
            const elementos = formFiltros.querySelectorAll('input, select');
            elementos.forEach(elemento => {
                if (elemento.tagName === 'SELECT') {
                    // Para SELECT, restablecer a la primera opci√≥n (Todos)
                    elemento.selectedIndex = 0;
                } else if (elemento.type === 'text' || elemento.type === 'number') {
                    // Para inputs de texto/n√∫mero, limpiar el valor
                    elemento.value = '';
                }
            });
        }

        // 3. Limpiar la tabla de resultados
        document.getElementById('cuerpoTabla').innerHTML = '';
        
        // 4. Ocultar la tabla y mostrar el estado de "listo para buscar"
        const tabla = document.getElementById('tablaResultados');
        const panelEstado = document.getElementById('panelEstado');
        tabla.classList.add('hidden');
        panelEstado.classList.remove('hidden');
        panelEstado.innerHTML = `<p style="color: var(--primary);">üßπ Campos Limpiados. Ingrese un RUC y use el bot√≥n 'Buscar'.</p>`;
    }


    // --- FUNCI√ìN PRINCIPAL DE B√öSQUEDA DE DATOS ---

    /**
     * Inicia el proceso de b√∫squeda filtrando los datos.
     * @param {Event} event - El evento (puede ser submit del form o click del bot√≥n).
     */
    async function buscarDatos(event) {
        event.preventDefault(); // Evita la recarga de la p√°gina si es un evento de formulario

        const ruc = document.getElementById('txtRUC').value.trim();
        const slcPeriodo = document.getElementById('slcPeriodo').value;
        const slcTipoDoc = document.getElementById('slcTipoDoc').value;
        const slcFirmado = document.getElementById('slcFirmado').value;
        const slcConformidad = document.getElementById('slcConformidad').value;

        const tabla = document.getElementById('tablaResultados');
        const cuerpoTabla = document.getElementById('cuerpoTabla');
        const panelEstado = document.getElementById('panelEstado');
        
        // 1. Validaci√≥n de RUC (M√≠nima)
        if (!ruc) {
            panelEstado.classList.remove('hidden');
            tabla.classList.add('hidden');
            panelEstado.innerHTML = '<p style="color: var(--color-rojo);">‚ö†Ô∏è Por favor, ingrese un RUC v√°lido para iniciar la b√∫squeda.</p>';
            return;
        }

        // 2. Mostrar estado de carga
        panelEstado.classList.remove('hidden');
        tabla.classList.add('hidden');
        cuerpoTabla.innerHTML = '';
        panelEstado.innerHTML = '<p style="color: var(--primary);">‚è≥ Buscando documentos, por favor espere...</p>';
        
        // 3. Simulaci√≥n de Fetch
        try {
            // Utilizamos un ID (el RUC) para simular la b√∫squeda en la API.
            // En un caso real, el RUC y los filtros ir√≠an en el body (POST) o query params (GET).
            const response = await fetch(`${API_URL_BASE}/${ruc}`); 
            
            if (!response.ok) {
                 // Si la respuesta HTTP no es 2xx, simulamos un error de no encontrado
                 throw new Error(`Error HTTP: ${response.status}. No se encontraron resultados para el RUC.`);
            }

            // Simulaci√≥n de datos complejos (ya que la API real devuelve un solo objeto 'todo')
            // Generaremos 5 documentos simulados
            const datosApi = await response.json();
            const documentosSimulados = [];

            // Generador de datos simulados
            const tiposDoc = ['NOMINA', 'CONTRATO', 'ANEXO'];
            const estadosFirmado = ['Si', 'No'];
            const estadosConformidad = ['Conforme', 'Pendiente', 'No Conforme'];
            const montos = [1200.50, 4500.00, 800.25, 15000.00, 950.99];

            for (let i = 1; i <= 5; i++) {
                const doc = {
                    ruc: ruc,
                    razonSocial: `Empresa S.A. ${ruc}`,
                    docId: `${ruc}-${i}`,
                    tipoDoc: tiposDoc[i % tiposDoc.length],
                    fechaEmision: `2024-${String(i+1).padStart(2, '0')}-01`,
                    fechaVencimiento: `2024-${String(i+1).padStart(2, '0')}-30`,
                    monto: montos[i % montos.length],
                    periodo: 2024,
                    firmado: estadosFirmado[i % 2],
                    conformidad: estadosConformidad[i % estadosConformidad.length],
                    observaciones: i === 3 ? 'Ajuste pendiente' : ''
                };
                documentosSimulados.push(doc);
            }

            // 4. Filtrar los documentos con base en los selectores avanzados
            const resultadosFiltrados = documentosSimulados.filter(doc => {
                let pasaFiltro = true;

                // Filtro Periodo
                if (slcPeriodo && doc.periodo != slcPeriodo) {
                    pasaFiltro = false;
                }
                // Filtro Tipo Documento
                if (slcTipoDoc && doc.tipoDoc !== slcTipoDoc) {
                    pasaFiltro = false;
                }
                // Filtro Firmado
                if (slcFirmado && doc.firmado !== slcFirmado) {
                    pasaFiltro = false;
                }
                // Filtro Conformidad
                if (slcConformidad && doc.conformidad !== slcConformidad) {
                    pasaFiltro = false;
                }

                return pasaFiltro;
            });

            // 5. Mostrar resultados
            if (resultadosFiltrados.length === 0) {
                panelEstado.classList.remove('hidden');
                tabla.classList.add('hidden');
                panelEstado.innerHTML = `
                    <p style="color: var(--color-rojo);">‚ùå No se encontraron documentos con los filtros seleccionados para el RUC: ${ruc}</p>
                    <p style="color: var(--color-gris);">Intente limpiar los filtros o verificar el RUC.</p>
                `;
            } else {
                resultadosFiltrados.forEach(doc => {
                    // Formato de Monto (simulado, asumiendo moneda local)
                    const montoFormateado = doc.monto.toLocaleString('es-PE', { style: 'currency', currency: 'PEN' });
                    
                    // Periodo con formato M-AAAA
                    const periodoCompleto = `${new Date(doc.fechaEmision).getMonth() + 1}-${doc.periodo}`;

                    // Etiquetas condicionales
                    const firmadoTag = generarEtiqueta(doc.firmado);
                    const conformidadTag = generarEtiqueta(doc.conformidad);

                    const fila = `
                        <tr>
                            <td>${doc.ruc}</td>
                            <td>${doc.razonSocial}</td>
                            <td>${doc.docId}</td>
                            <td>${doc.tipoDoc}</td>
                            <td>${doc.fechaEmision}</td>
                            <td>${doc.fechaVencimiento}</td>
                            <td>${montoFormateado}</td>
                            <td>${periodoCompleto}</td>
                            <td>${firmadoTag}</td>
                            <td>${conformidadTag}</td>
                            <td>${getDisplayValue(doc.observaciones, 'Sin obs.')}</td>
                        </tr>
                    `;
                    cuerpoTabla.innerHTML += fila;
                });

                // Mostrar la tabla y ocultar el mensaje de estado
                panelEstado.classList.add('hidden');
                tabla.classList.remove('hidden');
            }

        } catch (error) {
            console.error("Error en el proceso (Verifique CSP):", error);
            
            let mensajeErrorHTML = `
                <p style="color: red;">‚ùå Sin Resultados</p>`;
            
            // Diagn√≥stico espec√≠fico para el error "Failed to fetch" (el que indica bloqueo de red/CSP)
            if (String(error).includes('TypeError: Failed to fetch') || String(error).includes('NetworkError')) {
                mensajeErrorHTML = `
                    <p style="color: red;">‚ùå Sin resultados</p>
                `
            }

            panelEstado.innerHTML = mensajeErrorHTML;
        }
    }
    
    // Inicializaci√≥n: Ocultar los filtros al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', () => {
        const filtrosDiv = document.getElementById('filtrosAvanzados');
        // Aseguramos que se oculte al inicio, tal como estaba en el script original
        filtrosDiv.style.display = 'none'; 
        
        // El t√≠tulo del panel principal se ajusta ligeramente
        document.querySelector('h2').textContent = 'üîé B√∫squeda Documental';
    });
</script>

</body>
</html>
